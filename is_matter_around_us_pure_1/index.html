<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Conceptual Learning Quiz</title>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <style>
    /* Futuristic Background */
    body {
      margin:0; min-height:100vh;
      background: linear-gradient(135deg, #070e22 65%, #1afdff 100%);
      background-size: 150% 150%;
      animation: bgmove 8s ease-in-out alternate infinite;
      display: flex; justify-content: center; align-items: center;
      font-family: "Segoe UI", Arial, sans-serif;
      color:#eafaff; padding: 10px;
    }
    @keyframes bgmove {
      0% {background-position: 0 0;}
      100% {background-position: 100% 100%;}
    }

    /* Quiz Card */
    #card {
      background: rgba(21,52,85, 0.48);
      border-radius: 20px;
      box-shadow: 0 6px 30px #0ff4f840, 0 1.5px 3px #10ffdb44;
      backdrop-filter: blur(18px);
      max-width: 720px; width: 95%;
      padding: 28px;
      margin: 15px;
      text-align: center;
      border: 1.6px solid #12fff9bb;
    }

    /* Headers */
    h1 {
      font-size: 2.2em;
      background: linear-gradient(90deg,#08fff1, #73d9fd 73%,#ffffff33);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 2px 8px #00ffd444, 0 0px 36px #0ff5;
      margin: 0.2em 0 0.4em 0;
      letter-spacing: 0.75px;
      text-transform: uppercase;
      font-weight: 700;
    }

    #topic {
      font-size: 1.4em;
      margin-bottom: 25px;
      color: #99e5fd;
      letter-spacing: 0.7px;
      text-shadow: 0px .5px 6px #0ff3;
      padding: 2px 0 14px 0;
      font-weight: 500;
    }

    /* Question */
    #question {
      font-size: 1.25em;
      margin: 0.5em 0 1.2em 0;
      color: #fff;
      min-height: 50px;
      text-shadow: 0 1px 10px #23fff352;
      text-align: left;
    }

    /* Options */
    .option {
      background: linear-gradient(90deg,#1b425e91 0%,#0ff9 120%);
      margin: 14px 0;
      padding: 16px 12px;
      border-radius: 12px;
      border: none;
      font-size: 1.1em;
      box-shadow: 0 2px 12px #0ff8, 0 1px 4px #00ffc04f inset;
      transition: .19s;
      border-left: 4px solid #26ffe7aa;
      cursor: pointer;
      color: #eafaff;
      opacity: 1;
      outline: none;
      filter: brightness(1.03);
      position: relative;
      text-align: left;
    }

    .option:hover {
      filter: brightness(1.22);
      background: linear-gradient(90deg,#2e7fff9e 20%,#16e3ecff 140%);
    }

    .option.correct {
      background: linear-gradient(90deg,#29e0b8 0%,#7bffc9 110%);
      color: #202b20;
      border-left: 4px solid #23ff93;
      box-shadow: 0 1px 12px #6fffdc;
    }

    .option.incorrect {
      background: linear-gradient(90deg,#c94276,#ff8f85 96%);
      color: #fff4;
      opacity: .6;
    }

    /* Feedback Messages */
    #feedback {
      margin: 10px 0 8px 0;
      font-size: 1.1em;
      padding: 10px 16px;
      color: #fafaff;
      font-weight: 600;
      min-height: 20px;
      letter-spacing: .1em;
      border-radius: 8px;
      display: none;
    }

    #feedback.right {
      background: #23ffc4d5;
      color: #047454;
      box-shadow: 0 1px 11px #12ffbb2f;
    }

    #feedback.wrong {
      background: #ff7b8eec;
      color: #3d010a;
    }

    /* Explanation */
    #why {
      padding: 10px 12px;
      border-radius: 8px;
      margin: 12px 0 8px 0;
      background: #0ff7;
      color: #253b40;
      display: none;
      font-size: 1em;
      transition: opacity .2s;
      text-align: left;
    }

    /* Navigation Buttons */
    .nav-btns {
      display: flex;
      justify-content: space-between;
      margin-top: 18px;
      gap: 12px;
    }

    .nav-btns button {
      padding: 12px 20px;
      border: none;
      border-radius: 10px;
      font-size: 1.1em;
      font-weight: 600;
      cursor: pointer;
      transition: .2s;
      flex: 1;
      max-width: 150px;
    }

    #prevBtn {
      background: #888;
      color: white;
    }

    #prevBtn:hover:not(:disabled) {
      background: #666;
    }

    #prevBtn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    #nextBtn {
      background: linear-gradient(90deg,#07faf1 0%,#13daff 90%);
      color: #043;
      box-shadow: 0 2px 16px #05ffdd11;
    }

    #nextBtn:hover {
      filter: brightness(1.1);
    }

    /* Results */
    #result {
      margin-top: 25px;
      font-size: 1.4em;
      padding: 8px 0 4px 0;
      font-weight: bold;
      color: #23ffbb;
      text-shadow: 0 2px 11px #04ffd880;
      display: none;
    }

    /* Summary Table */
    #summaryTable {
      margin: 25px auto 8px auto;
      width: 100%;
      background: #0ff3;
      border-radius: 10px;
      border-collapse: collapse;
      box-shadow: 0 1.5px 8px #00ffd410;
      font-size: 0.95em;
    }

    #summaryTable th, #summaryTable td {
      padding: 10px 8px;
      text-align: left;
      border: none;
    }

    #summaryTable th {
      background: #11e7abde;
      color: #08383a;
      font-weight: 600;
    }

    #summaryTable tr.right {
      background: #e9fff3;
      color: #0a4a0a;
    }

    #summaryTable tr.wrong {
      background: #ffe0e7;
      color: #4a0a0a;
    }

    /* Restart Button */
    #restart {
      margin-top: 25px;
      padding: 12px 40px;
      border: none;
      border-radius: 10px;
      background: linear-gradient(90deg,#07faf1 0%,#13daff 90%);
      color: #043;
      font-size: 1.2em;
      font-weight: 700;
      box-shadow: 0 2px 16px #05ffdd11;
      letter-spacing: .08em;
      cursor: pointer;
      display: none;
      transition: .2s;
    }

    #restart:hover {
      filter: brightness(1.1);
    }

    /* Mobile Responsive */
    @media (max-width: 600px) {
      #card {
        padding: 20px 16px;
        margin: 8px;
      }
      
      h1 {
        font-size: 1.8em;
      }
      
      #topic {
        font-size: 1.2em;
      }
      
      #question {
        font-size: 1.1em;
      }
      
      .option {
        font-size: 1em;
        padding: 14px 10px;
      }
      
      .nav-btns button {
        padding: 10px 16px;
        font-size: 1em;
      }
      
      #summaryTable {
        font-size: 0.85em;
      }
      
      #summaryTable th, #summaryTable td {
        padding: 8px 6px;
      }
    }
  </style>
</head>
<body>
  <div id="card">
    <h1>Conceptual Learning</h1>
    <div id="topic">Loading Quiz...</div>
    <div id="question"></div>
    <div id="options"></div>
    <div id="feedback"></div>
    <div id="why"></div>
    
    <div class="nav-btns">
      <button id="prevBtn">Previous</button>
      <button id="nextBtn">Next</button>
    </div>
    
    <div id="result"></div>
    <div id="summary"></div>
    <button id="restart">Restart Quiz</button>
  </div>

  <script>
    // ========== CONFIG ==========
    const QUESTIONS_PER_SESSION = 20;
    const QUIZ_TOPIC = "Is Matter Aroud Us Pure Part-1, Class- X"; // Change this for each quiz!

    // ========== GLOBALS ==========
    let bank = [], quiz = [], idx = 0, score = 0, answerRecord = [];
    
    const topicEl = document.getElementById("topic"),
          qEl = document.getElementById("question"),
          oEl = document.getElementById("options"),
          fbEl = document.getElementById("feedback"),
          wEl = document.getElementById("why"),
          rEl = document.getElementById("result"),
          sumEl = document.getElementById("summary"),
          btnRestart = document.getElementById("restart"),
          btnPrev = document.getElementById("prevBtn"),
          btnNext = document.getElementById("nextBtn");

    // ========== LOAD CSV ==========
    fetch('quiz.csv')
      .then(r => r.text())
      .then(csv => {
        bank = Papa.parse(csv, {header: true, skipEmptyLines: true}).data
          .filter(row => row.Question && row.Correct);
        
        if (bank.length < QUESTIONS_PER_SESSION) {
          alert(`Not enough questions in quiz.csv! Found ${bank.length}, need ${QUESTIONS_PER_SESSION}`);
          return;
        }
        
        topicEl.textContent = QUIZ_TOPIC;
        startNewSession();
      })
      .catch(err => {
        alert("Cannot load quiz.csv - check filename & sharing settings");
        console.error(err);
      });

    // ========== SESSION MANAGEMENT ==========
    function startNewSession() {
      quiz = shuffle(bank).slice(0, QUESTIONS_PER_SESSION);
      idx = 0;
      score = 0;
      answerRecord = [];
      
      // Hide results
      rEl.style.display = 'none';
      sumEl.innerHTML = '';
      btnRestart.style.display = 'none';
      
      // Show quiz elements
      qEl.style.display = 'block';
      oEl.style.display = 'block';
      document.querySelector('.nav-btns').style.display = 'flex';
      
      load();
    }

    function load() {
      if (idx >= quiz.length) {
        finish();
        return;
      }
      
      const cur = quiz[idx];
      qEl.textContent = `${idx + 1}/${quiz.length}: ${cur.Question}`;
      oEl.innerHTML = "";
      fbEl.style.display = 'none';
      wEl.style.display = 'none';
      
      let answered = answerRecord[idx] ? true : false;

      ['Option A', 'Option B', 'Option C', 'Option D'].forEach((key, i) => {
        const div = document.createElement("div");
        div.className = "option";
        div.textContent = cur[key];
        
        div.onclick = () => {
          if (answered) return; // Question already answered
          answered = true;
          
          const right = 'ABCD'.indexOf(cur.Correct.trim().toUpperCase());
          const result = (i === right);
          
          if (result) {
            div.classList.add('correct');
            fbEl.textContent = "Correct! ðŸŒŸ";
            fbEl.className = "right";
            fbEl.style.display = 'block';
            score++;
          } else {
            div.classList.add('incorrect');
            fbEl.textContent = `Wrong! Correct: ${cur['Option ' + ['A','B','C','D'][right]]}`;
            fbEl.className = "wrong";
            fbEl.style.display = 'block';
            // Highlight the correct answer
            oEl.children[right].classList.add('correct');
          }
          
          // Show explanation if available
          if (cur.Reasoning && cur.Reasoning.trim() !== "") {
            wEl.textContent = cur.Reasoning;
            wEl.style.display = 'block';
          }
          
          // Record the answer
          answerRecord[idx] = {
            num: idx + 1,
            q: cur.Question,
            your: cur[key],
            correct: cur['Option ' + ['A','B','C','D'][right]],
            isright: result
          };
        };
        
        oEl.appendChild(div);
      });

      // Update navigation buttons
      btnPrev.disabled = (idx === 0);
      btnNext.textContent = (idx === quiz.length - 1) ? "Finish" : "Next";
    }

    // ========== NAVIGATION ==========
    btnPrev.onclick = () => {
      if (idx > 0) {
        idx--;
        load();
      }
    };

    btnNext.onclick = () => {
      if (idx < quiz.length - 1) {
        idx++;
        load();
      } else {
        finish();
      }
    };

    // ========== FINISH QUIZ ==========
    function finish() {
      // Hide quiz elements
      qEl.style.display = 'none';
      oEl.style.display = 'none';
      fbEl.style.display = 'none';
      wEl.style.display = 'none';
      document.querySelector('.nav-btns').style.display = 'none';
      
      // Show results
      rEl.textContent = `Quiz Complete! Your Score: ${score}/${quiz.length} (${Math.round(score/quiz.length*100)}%)`;
      rEl.style.display = 'block';
      
      // Create summary table
      let tableHTML = `
        <table id="summaryTable">
          <tr>
            <th>#</th>
            <th>Question</th>
            <th>Your Answer</th>
            <th>Correct Answer</th>
            <th>Status</th>
          </tr>
      `;
      
      quiz.forEach((q, i) => {
        const record = answerRecord[i];
        if (record) {
          tableHTML += `
            <tr class="${record.isright ? 'right' : 'wrong'}">
              <td>${record.num}</td>
              <td>${record.q}</td>
              <td>${record.your}</td>
              <td>${record.correct}</td>
              <td>${record.isright ? '<span style="color:#0a6">âœ”</span>' : '<span style="color:#b00">âœ—</span>'}</td>
            </tr>
          `;
        } else {
          // Unanswered question
          const right = 'ABCD'.indexOf(q.Correct.trim().toUpperCase());
          tableHTML += `
            <tr class="wrong">
              <td>${i + 1}</td>
              <td>${q.Question}</td>
              <td>Not answered</td>
              <td>${q['Option ' + ['A','B','C','D'][right]]}</td>
              <td><span style="color:#b00">âœ—</span></td>
            </tr>
          `;
        }
      });
      
      tableHTML += '</table>';
      sumEl.innerHTML = tableHTML;
      
      btnRestart.style.display = 'inline-block';
    }

    // ========== RESTART ==========
    btnRestart.onclick = () => {
      qEl.style.display = 'block';
      oEl.style.display = 'block';
      document.querySelector('.nav-btns').style.display = 'flex';
      startNewSession();
    };

    // ========== UTILITY ==========
    function shuffle(arr) {
      return arr.map(v => [Math.random(), v])
                .sort((a, b) => a[0] - b[0])
                .map(v => v[1]);
    }
  </script>
</body>
</html>

